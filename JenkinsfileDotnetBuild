pipeline {
  agent any
    stages {

  stage ('Clean workspace') {
  steps {
    cleanWs()
  }
}


  stage ('Checkout SCM'){
        steps {
          checkout([$class: 'GitSCM', branches: [[name: '*/main']], doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [], userRemoteConfigs: [[credentialsId: 'Git', url: 'https://github.com/Prasannamugundhan/poc_demo.git']]])
      }
   }

	stage('Dependencies') {
     	 	steps {
		
       	 	 sh "dotnet restore"
     	 
       } 
       }

	  //Build stage
	stage ('Build')  {
	    steps {
        
            sh "dotnet build"
	    sh "npm audit fix --force"
          
        }    
   }
        stage ('Run')  {
	    steps {
        
            sh "dotnet run"
          
        }    
   }
   
    //Testing Phase
	stage('Test') {
          steps {
          sh "dotnet test -l:trx || true"        
      }
    }
   }
	post {
   	 always {
      	mstest(testResultsFile: '**/*.trx', failOnError: false, keepLongStdio: true)
    
  }
      
    }
}

